package com.slate{	import com.brightcove.api.APIModules;	import com.brightcove.api.BrightcoveModuleWrapper;	import com.brightcove.api.events.AdEvent;	import com.brightcove.api.events.MediaEvent;	import com.brightcove.api.modules.AdvertisingModule;	import com.brightcove.api.modules.ContentModule;	import com.brightcove.api.modules.VideoPlayerModule;		import flash.display.Sprite;		public class VideoTracker extends Sprite	{		private var _adPlayed:Boolean;		private var _advertising:AdvertisingModule;		private var _content:ContentModule;        private var _eventTracker:Object;		private var _omni:OmnitureDelegate;		private var _player:BrightcoveModuleWrapper;		private var _video:VideoPlayerModule;		private var _videoID:int;		private var _videoTitle:String;		public function VideoTracker(p:BrightcoveModuleWrapper)		{			trace("[VideoTracker instantiated]");			_player = p;			_advertising = _player.getModule(APIModules.ADVERTISING) as AdvertisingModule;			_content = _player.getModule(APIModules.CONTENT) as ContentModule;			_eventTracker = {twentyFive:false, fifty:false, seventyFive:false, complete:false};			_video = _player.getModule(APIModules.VIDEO_PLAYER) as VideoPlayerModule;			_videoID = _video.getCurrentVideo().id;			_videoTitle = _video.getCurrentVideo().displayName;						_advertising.addEventListener(AdEvent.AD_START, handleEvents);			_advertising.addEventListener(AdEvent.AD_COMPLETE, handleEvents);						_video.addEventListener(MediaEvent.BEGIN, handleEvents);			_video.addEventListener(MediaEvent.COMPLETE, handleEvents);			_video.addEventListener(MediaEvent.PROGRESS, handleEvents);			_omni = new OmnitureDelegate();			_omni.s.eVar13 = _videoTitle + " (" + _video.getVideoDuration() + ") - " + _videoID;			_omni.s.eVar14 = "slate.com";		}		private function handleEvents(evt:*):void		{			switch(evt.type)			{				case "adStart":                    _omni.s.events = "event16";                    _omni.s.trackLink(loaderInfo.url, "o", "Video Ad Start");                    _omni.s.events = "";										break;				case "adComplete":					_adPlayed = true;					break;				case "mediaBegin":					var name:String = (_adPlayed)? "Video Start With Ad" : "Video Start"                    _omni.s.events = "event9";                    _omni.s.trackLink(loaderInfo.url, "o", name);                    _omni.s.events = "";					break;				case "mediaComplete":                        _omni.s.events = "event13";                        _omni.s.trackLink(loaderInfo.url, "o", "Video Complete");                        _omni.s.events = "";						_adPlayed = false;					break;				case "mediaProgress":					checkProgress();					break;			}		}        private function checkProgress():void 		{            var percentComplete:Number = Math.round(Number(_video.getVideoPosition()) / Number(_video.getVideoDuration()) * 100);            switch(percentComplete){                case 25:                    if (!_eventTracker.twentyFive){                        _omni.s.events = "event10";                        _omni.s.trackLink(loaderInfo.url, "o", "Video 25 Percent");                        _omni.s.events = "";                        _eventTracker.twentyFive = true;                    }                    break;                case 50:                    if (!_eventTracker.fifty){                        _omni.s.events = "event11";                        _omni.s.trackLink(loaderInfo.url, "o", "Video 50 Percent");                        _omni.s.events = "";                        _eventTracker.fifty = true;                    }                    break;                case 75:                    if (!_eventTracker.seventyFive){                        _omni.s.events = "event12";                        _omni.s.trackLink(loaderInfo.url, "o", "Video 75 Percent");                        _omni.s.events = "";                        _eventTracker.seventyFive = true;                    }                    break;                case 99:                    if (!_eventTracker.complete){                        _omni.s.events = "event13";                        _omni.s.trackLink(loaderInfo.url, "o", "Video Complete");                        _omni.s.events = "";                        _eventTracker.complete = true;                    }                    break;            }        }	}}